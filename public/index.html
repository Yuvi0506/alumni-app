<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loyola Alumni Network - USA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            color: #0a2351;
        }
        .header {
            background: #0a2351;
            color: #fff;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid #ffc107;
        }
        .header img.logo {
            width: 80px;
            vertical-align: middle;
            margin-right: 15px;
        }
        .header h1 {
            display: inline-block;
            margin: 0;
            font-size: 2em;
            font-weight: 600;
            vertical-align: middle;
        }
        .header p {
            margin: 5px 0 0;
            font-size: 1em;
            font-style: italic;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 15px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #0a2351;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .hidden {
            display: none;
        }
        .login-form, .edit-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 350px;
            margin: 0 auto 20px;
        }
        .search-form {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        .search-form input {
            width: 300px;
            padding: 10px;
            border: 2px solid #0a2351;
            border-radius: 6px 0 0 6px;
            font-size: 0.9em;
        }
        .search-form button {
            padding: 10px 15px;
            background: #0a2351;
            color: white;
            border: none;
            border-radius: 0 6px 6px 0;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        .search-form button:hover {
            background: #1a3c78;
        }
        input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: #0a2351;
            outline: none;
        }
        button {
            padding: 10px;
            background: #0a2351;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: background 0.3s, transform 0.2s;
        }
        button:hover {
            background: #1a3c78;
            transform: translateY(-1px);
        }
        .alumni-list {
            margin: 20px 0;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }
        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #0a2351;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        tr:hover {
            background: #e9ecef;
        }
        a {
            color: #ffc107;
            text-decoration: none;
            transition: color 0.3s;
        }
        a:hover {
            color: #ff8c00;
        }
        .admin-actions button {
            padding: 6px 10px;
            font-size: 0.8em;
            margin-right: 5px;
        }
        .admin-actions button.edit {
            background: #28a745;
        }
        .admin-actions button.delete {
            background: #dc3545;
        }
        .admin-actions button.edit:hover {
            background: #218838;
        }
        .admin-actions button.delete:hover {
            background: #c82333;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        .pagination button {
            padding: 8px 12px;
            background: #ddd;
            color: #0a2351;
            border-radius: 5px;
        }
        .pagination button.active {
            background: #0a2351;
            color: white;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ffc107;
            color: #0a2351;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
        }
        .theme-toggle:hover {
            background: #ff8c00;
        }
        #editForm input {
            width: calc(50% - 8px);
            display: inline-block;
            margin: 4px;
        }
        #editForm input.full-width {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/yuvi0506/alumni-app/main/public/logo.png" alt="LAA Logo" class="logo">
        <h1>Loyola Alumni Network - USA</h1>
        <p>Loyola College, Chennai - College of Excellence<br>Let Your Light Shine</p>
    </div>
    <div class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</div>
    <div class="container">
        <div id="loginSection">
            <div class="login-form">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button onclick="login()">Login</button>
            </div>
        </div>
        <div id="mainSection" class="hidden">
            <div class="search-form">
                <input type="text" id="searchInput" placeholder="Search alumni..." onkeyup="searchAlumni()">
                <button onclick="searchAlumni()">Search</button>
            </div>
            <div class="alumni-list">
                <table id="alumniTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Institute</th>
                            <th>Course</th>
                            <th>Batch Year</th>
                            <th>Current Org</th>
                            <th>Position</th>
                            <th>Past Exp</th>
                            <th>LinkedIn</th>
                            <th>Mobile</th>
                            <th>Other</th>
                            <th class="admin-column hidden">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="alumniList"></tbody>
                </table>
            </div>
            <div class="pagination" id="pagination"></div>
            <div id="editForm" class="hidden">
                <h2>Add Alumni</h2>
                <div class="edit-form">
                    <input type="text" id="name" placeholder="Name" required>
                    <input type="text" id="location" placeholder="Location" required>
                    <input type="text" id="institute" placeholder="Institute" required>
                    <input type="text" id="course" placeholder="Course" required>
                    <input type="text" id="batchYear" placeholder="Batch Year" required>
                    <input type="text" id="currentOrg" placeholder="Current Organization" required>
                    <input type="text" id="currentPosition" placeholder="Current Position" required>
                    <input type="text" id="pastExperience" placeholder="Past Experience">
                    <input type="text" id="linkedin" placeholder="LinkedIn Profile">
                    <input type="text" id="mobile" placeholder="Mobile Number" required>
                    <input class="full-width" type="text" id="otherDetails" placeholder="Other Details">
                    <button onclick="addAlumni()">Add New Alumni</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userRole = null;
        let currentPage = 1;
        let searchTerm = '';
        const itemsPerPage = 5;

        // Display alumni list in table
        function displayAlumni(data, totalPages) {
            const list = document.getElementById('alumniList');
            list.innerHTML = data.map(a => `
                <tr data-id="${a._id}">
                    <td>${a.name}</td>
                    <td>${a.location}</td>
                    <td>${a.institute}</td>
                    <td>${a.course}</td>
                    <td>${a.batchYear}</td>
                    <td>${a.currentOrg}</td>
                    <td>${a.currentPosition}</td>
                    <td>${a.pastExperience}</td>
                    <td><a href="${a.linkedin}" target="_blank">${a.linkedin}</a></td>
                    <td>${a.mobile}</td>
                    <td>${a.otherDetails}</td>
                    ${userRole === 'admin' ? `
                        <td class="admin-column">
                            <div class="admin-actions">
                                <button class="edit" onclick="editAlumni('${a._id}')">Edit</button>
                                <button class="delete" onclick="removeAlumni('${a._id}')">Delete</button>
                            </div>
                        </td>
                    ` : '<td class="admin-column hidden"></td>'}
                </tr>
            `).join('');

            // Show admin column only for admin users
            const adminColumn = document.querySelectorAll('.admin-column');
            adminColumn.forEach(col => {
                if (userRole === 'admin') {
                    col.classList.remove('hidden');
                } else {
                    col.classList.add('hidden');
                }
            });

            renderPagination(totalPages);
        }

        // Render pagination
        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.onclick = () => {
                    currentPage = i;
                    fetchAlumni();
                };
                pagination.appendChild(btn);
            }
        }

        // Login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    userRole = data.role;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('mainSection').classList.remove('hidden');
                    if (userRole === 'admin') {
                        document.getElementById('editForm').classList.remove('hidden');
                    }
                    fetchAlumni();
                } else {
                    alert('Login failed. Check credentials.');
                }
            });
        }

        // Fetch alumni data with optional search term
        function fetchAlumni() {
            const query = searchTerm ? `?page=${currentPage}&limit=${itemsPerPage}&search=${encodeURIComponent(searchTerm)}` : `?page=${currentPage}&limit=${itemsPerPage}`;
            fetch(`/api/alumni${query}`)
                .then(response => response.json())
                .then(data => displayAlumni(data.alumni, data.pages));
        }

        // Search alumni
        function searchAlumni() {
            searchTerm = document.getElementById('searchInput').value.trim();
            currentPage = 1; // Reset to first page on new search
            fetchAlumni();
        }

        // Add new alumni
        function addAlumni() {
            const alumni = {
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                institute: document.getElementById('institute').value,
                course: document.getElementById('course').value,
                batchYear: document.getElementById('batchYear').value,
                currentOrg: document.getElementById('currentOrg').value,
                currentPosition: document.getElementById('currentPosition').value,
                pastExperience: document.getElementById('pastExperience').value,
                linkedin: document.getElementById('linkedin').value,
                mobile: document.getElementById('mobile').value,
                otherDetails: document.getElementById('otherDetails').value,
                role: userRole
            };
            fetch('/api/alumni', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(alumni)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchAlumni();
                    document.querySelectorAll('#editForm input').forEach(input => input.value = '');
                    alert('Alumni added!');
                } else {
                    alert(data.message);
                }
            });
        }

        // Edit alumni
        function editAlumni(id) {
            fetch('/api/alumni')
                .then(response => response.json())
                .then(data => {
                    const alumni = data.alumni.find(a => a._id === id);
                    if (alumni) {
                        document.getElementById('name').value = alumni.name;
                        document.getElementById('location').value = alumni.location;
                        document.getElementById('institute').value = alumni.institute;
                        document.getElementById('course').value = alumni.course;
                        document.getElementById('batchYear').value = alumni.batchYear;
                        document.getElementById('currentOrg').value = alumni.currentOrg;
                        document.getElementById('currentPosition').value = alumni.currentPosition;
                        document.getElementById('pastExperience').value = alumni.pastExperience;
                        document.getElementById('linkedin').value = alumni.linkedin;
                        document.getElementById('mobile').value = alumni.mobile;
                        document.getElementById('otherDetails').value = alumni.otherDetails;

                        const submitBtn = document.querySelector('#editForm button');
                        submitBtn.textContent = 'Update Alumni';
                        submitBtn.onclick = () => updateAlumni(id);
                    }
                });
        }

        // Update alumni
        function updateAlumni(id) {
            const alumni = {
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                institute: document.getElementById('institute').value,
                course: document.getElementById('course').value,
                batchYear: document.getElementById('batchYear').value,
                currentOrg: document.getElementById('currentOrg').value,
                currentPosition: document.getElementById('currentPosition').value,
                pastExperience: document.getElementById('pastExperience').value,
                linkedin: document.getElementById('linkedin').value,
                mobile: document.getElementById('mobile').value,
                otherDetails: document.getElementById('otherDetails').value,
                role: userRole
            };
            fetch(`/api/alumni?id=${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(alumni)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchAlumni();
                    document.querySelectorAll('#editForm input').forEach(input => input.value = '');
                    const submitBtn = document.querySelector('#editForm button');
                    submitBtn.textContent = 'Add New Alumni';
                    submitBtn.onclick = addAlumni;
                    alert('Alumni updated!');
                } else {
                    alert(data.message);
                }
            });
        }

        // Remove alumni
        function removeAlumni(id) {
            if (confirm('Are you sure you want to delete this alumni record?')) {
                fetch(`/api/alumni?id=${id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role: userRole })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        fetchAlumni();
                        alert('Alumni removed!');
                    } else {
                        alert(data.message);
                    }
                });
            }
        }

        // Theme toggle (kept for consistency, but can be removed if not needed)
        function toggleTheme() {
            // Theme toggle removed for branding consistency
        }
    </script>
</body>
</html>
