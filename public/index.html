<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loyola Alumni Network - USA</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            color: #333333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header {
            background: #003087;
            color: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 3px solid #f5c518;
        }
        .header-left {
            display: flex;
            align-items: center;
        }
        .header img.logo {
            width: 60px;
            margin-right: 15px;
        }
        .header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 500;
        }
        .header p {
            margin: 5px 0 0;
            font-size: 0.9em;
            font-style: italic;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-size: 0.9em;
        }
        .user-info .user-icon {
            font-size: 1.2em;
            cursor: pointer;
        }
        .user-info button {
            padding: 6px 12px;
            background: #dc3545;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            color: #fff;
        }
        .user-info button:hover {
            background: #c82333;
        }
        .container {
            max-width: 1100px;
            margin: 20px auto;
            padding: 15px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        h2 {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            background: #003087;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
            margin-left: auto;
            margin-right: auto;
            width: fit-content;
        }
        .hidden {
            display: none;
        }
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 350px;
            margin: 0 auto 20px;
        }
        .search-form {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .search-form input {
            width: 300px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px 0 0 5px;
            font-size: 0.9em;
        }
        .search-form button {
            padding: 10px 15px;
            background: #003087;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        .search-form button:hover {
            background: #005566;
        }
        .search-form select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9em;
        }
        input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9em;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: #003087;
            outline: none;
        }
        button {
            padding: 10px;
            background: #003087;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background 0.3s;
        }
        button:hover {
            background: #005566;
        }
        button.details-btn {
            background: #17a2b8;
            padding: 4px 8px;
            font-size: 0.8em;
        }
        button.details-btn:hover {
            background: #138496;
        }
        .alumni-list {
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            table-layout: fixed;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        th:nth-child(1), td:nth-child(1) { width: 14%; } /* Name */
        th:nth-child(2), td:nth-child(2) { width: 14%; } /* Location */
        th:nth-child(3), td:nth-child(3) { width: 14%; } /* Institute */
        th:nth-child(4), td:nth-child(4) { width: 12%; } /* Course */
        th:nth-child(5), td:nth-child(5) { width: 12%; } /* Batch Year */
        th:nth-child(6), td:nth-child(6) { width: 14%; } /* Current Org */
        th:nth-child(7), td:nth-child(7) { width: 12%; } /* Position */
        th:nth-child(8), td:nth-child(8) { width: 8%; } /* Details */
        th:nth-child(9), td:nth-child(9) { width: 10%; } /* Actions */
        th {
            background: #003087;
            color: white;
            font-weight: 500;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        tr:hover {
            background: #e9ecef;
        }
        a {
            color: #003087;
            text-decoration: none;
            transition: color 0.3s;
        }
        a:hover {
            color: #f5c518;
        }
        .admin-actions button {
            padding: 5px 8px;
            font-size: 0.8em;
            margin-right: 5px;
        }
        .admin-actions button.edit {
            background: #28a745;
        }
        .admin-actions button.delete {
            background: #dc3545;
        }
        .admin-actions button.edit:hover {
            background: #218838;
        }
        .admin-actions button.delete:hover {
            background: #c82333;
        }
        .details-row {
            background: #f8f9fa;
            border-bottom: 2px solid #ddd;
        }
        .details-row td {
            padding: 15px;
            white-space: normal;
        }
        .details-content {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .details-content p {
            margin: 5px 0;
            flex: 1 1 45%;
        }
        .details-content p strong {
            color: #003087;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        .pagination button {
            padding: 8px 12px;
            background: #ddd;
            color: #333333;
            border-radius: 5px;
        }
        .pagination button.active {
            background: #003087;
            color: white;
        }
        .edit-form-container {
            max-width: 800px;
            margin: 0 auto 20px;
        }
        .edit-form {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }
        .edit-form .column {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .edit-form input {
            width: 100%;
            box-sizing: border-box;
        }
        .edit-form .submit-btn {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }
        .edit-form .submit-btn button {
            padding: 12px 30px;
            font-size: 1em;
            width: fit-content;
        }
        footer {
            background: #003087;
            color: #fff;
            padding: 15px 20px;
            text-align: center;
            border-top: 3px solid #f5c518;
            font-size: 0.9em;
            font-weight: 400;
        }
        footer p {
            margin: 0;
        }
        @media (max-width: 768px) {
            .edit-form {
                flex-direction: column;
                gap: 15px;
            }
            .edit-form .column {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <img src="logo.png" alt="LAA Logo" class="logo">
            <div>
                <h1>Loyola Alumni Network - USA</h1>
                <p>Loyola College, Chennai - College of Excellence<br>Let Your Light Shine</p>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info" id="userInfo">
                <span id="loggedInUser"></span>
                <span class="user-icon">ðŸ‘¤</span>
                <button id="logoutButton" class="hidden" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>
    <div class="container">
        <div id="loginSection">
            <div class="login-form">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button onclick="login()">Login</button>
            </div>
        </div>
        <div id="mainSection" class="hidden">
            <div class="search-form">
                <input type="text" id="searchInput" placeholder="Search alumni..." onkeyup="searchAlumni()">
                <button onclick="searchAlumni()">Search</button>
                <select id="pageSize" onchange="updatePageSize()">
                    <option value="5">5 per page</option>
                    <option value="10">10 per page</option>
                    <option value="15">15 per page</option>
                </select>
            </div>
            <div class="alumni-list">
                <table id="alumniTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Institute</th>
                            <th>Course</th>
                            <th>Batch Year</th>
                            <th>Current Org</th>
                            <th>Position</th>
                            <th>Details</th>
                            <th class="admin-column hidden">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="alumniList"></tbody>
                </table>
            </div>
            <div class="pagination" id="pagination"></div>
            <div id="editForm" class="hidden">
                <div class="edit-form-container">
                    <h2>Add Alumni</h2>
                    <div class="edit-form">
                        <div class="column">
                            <input type="text" id="name" placeholder="Name" required>
                            <input type="text" id="location" placeholder="Location" required>
                            <input type="text" id="institute" placeholder="Institute" required>
                            <input type="text" id="course" placeholder="Course" required>
                            <input type="text" id="batchYear" placeholder="Batch Year" required>
                            <input type="text" id="currentOrg" placeholder="Current Organization" required>
                        </div>
                        <div class="column">
                            <input type="text" id="currentPosition" placeholder="Current Position" required>
                            <input type="text" id="pastExperience" placeholder="Past Experience">
                            <input type="text" id="linkedin" placeholder="LinkedIn Profile">
                            <input type="email" id="email" placeholder="Email" required>
                            <input type="text" id="mobile" placeholder="Mobile Number" required>
                            <input type="text" id="otherDetails" placeholder="Other Details">
                        </div>
                    </div>
                    <div class="submit-btn">
                        <button onclick="addAlumni()">Add New Alumni</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>Â©2025 Loyola Alumni Network - USA. All rights reserved.</p>
    </footer>

    <script>
        let userRole = null;
        let currentPage = 1;
        let searchTerm = '';
        let itemsPerPage = 5;
        let expandedRow = null;

        // Display alumni list in table
        function displayAlumni(data, totalPages) {
            const list = document.getElementById('alumniList');
            list.innerHTML = '';
            data.forEach(a => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', a._id);
                row.innerHTML = `
                    <td>${a.name}</td>
                    <td>${a.location}</td>
                    <td>${a.institute}</td>
                    <td>${a.course}</td>
                    <td>${a.batchYear}</td>
                    <td>${a.currentOrg}</td>
                    <td>${a.currentPosition}</td>
                    <td><button class="details-btn" onclick="toggleDetails('${a._id}')">Details</button></td>
                    ${userRole === 'admin' ? `
                        <td class="admin-column">
                            <div class="admin-actions">
                                <button class="edit" onclick="editAlumni('${a._id}')">Edit</button>
                                <button class="delete" onclick="removeAlumni('${a._id}')">Delete</button>
                            </div>
                        </td>
                    ` : '<td class="admin-column hidden"></td>'}
                `;
                list.appendChild(row);

                // Add details row (hidden by default)
                const detailsRow = document.createElement('tr');
                detailsRow.classList.add('details-row');
                detailsRow.id = `details-${a._id}`;
                detailsRow.classList.add('hidden');
                detailsRow.innerHTML = `
                    <td colspan="9">
                        <div class="details-content">
                            <p><strong>Name:</strong> ${a.name}</p>
                            <p><strong>Location:</strong> ${a.location}</p>
                            <p><strong>Institute:</strong> ${a.institute}</p>
                            <p><strong>Course:</strong> ${a.course}</p>
                            <p><strong>Batch Year:</strong> ${a.batchYear}</p>
                            <p><strong>Current Org:</strong> ${a.currentOrg}</p>
                            <p><strong>Position:</strong> ${a.currentPosition}</p>
                            <p><strong>Past Experience:</strong> ${a.pastExperience}</p>
                            <p><strong>LinkedIn:</strong> <a href="${a.linkedin}" target="_blank">${a.linkedin}</a></p>
                            <p><strong>Mobile:</strong> ${a.mobile}</p>
                            <p><strong>Email:</strong> ${a.email}</p>
                            <p><strong>Other Details:</strong> ${a.otherDetails}</p>
                        </div>
                    </td>
                `;
                list.appendChild(detailsRow);
            });

            // Show admin column only for admin users
            const adminColumn = document.querySelectorAll('.admin-column');
            adminColumn.forEach(col => {
                if (userRole === 'admin') {
                    col.classList.remove('hidden');
                } else {
                    col.classList.add('hidden');
                }
            });

            renderPagination(totalPages);
        }

        // Toggle details view
        function toggleDetails(id) {
            const detailsRow = document.getElementById(`details-${id}`);
            if (expandedRow && expandedRow !== detailsRow) {
                expandedRow.classList.add('hidden');
            }
            detailsRow.classList.toggle('hidden');
            expandedRow = detailsRow.classList.contains('hidden') ? null : detailsRow;
        }

        // Render pagination
        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.onclick = () => {
                    currentPage = i;
                    fetchAlumni();
                };
                pagination.appendChild(btn);
            }
        }

        // Login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    userRole = data.role;
                    localStorage.setItem('userRole', userRole);
                    localStorage.setItem('username', username);
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('mainSection').classList.remove('hidden');
                    document.getElementById('logoutButton').classList.remove('hidden');
                    document.getElementById('loggedInUser').textContent = `Welcome, ${username}`;
                    if (userRole === 'admin') {
                        document.getElementById('editForm').classList.remove('hidden');
                    }
                    fetchAlumni();
                } else {
                    alert('Login failed. Check credentials.');
                }
            });
        }

        // Logout
        function logout() {
            userRole = null;
            localStorage.removeItem('userRole');
            localStorage.removeItem('username');
            document.getElementById('logoutButton').classList.add('hidden');
            document.getElementById('loggedInUser').textContent = '';
            document.getElementById('mainSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('searchInput').value = '';
            searchTerm = '';
            currentPage = 1;
        }

        // Check if user is already logged in
        window.onload = function() {
            const storedRole = localStorage.getItem('userRole');
            const storedUsername = localStorage.getItem('username');
            if (storedRole && storedUsername) {
                userRole = storedRole;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('mainSection').classList.remove('hidden');
                document.getElementById('logoutButton').classList.remove('hidden');
                document.getElementById('loggedInUser').textContent = `Welcome, ${storedUsername}`;
                if (userRole === 'admin') {
                    document.getElementById('editForm').classList.remove('hidden');
                }
                fetchAlumni();
            }
        };

        // Fetch alumni data with optional search term and page size
        function fetchAlumni() {
            const query = searchTerm 
                ? `?page=${currentPage}&limit=${itemsPerPage}&search=${encodeURIComponent(searchTerm)}` 
                : `?page=${currentPage}&limit=${itemsPerPage}`;
            fetch(`/api/alumni${query}`)
                .then(response => response.json())
                .then(data => displayAlumni(data.alumni, data.pages));
        }

        // Search alumni
        function searchAlumni() {
            searchTerm = document.getElementById('searchInput').value.trim();
            currentPage = 1; // Reset to first page on new search
            fetchAlumni();
        }

        // Update page size
        function updatePageSize() {
            itemsPerPage = parseInt(document.getElementById('pageSize').value);
            currentPage = 1; // Reset to first page on page size change
            fetchAlumni();
        }

        // Add new alumni
        function addAlumni() {
            const alumni = {
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                institute: document.getElementById('institute').value,
                course: document.getElementById('course').value,
                batchYear: document.getElementById('batchYear').value,
                currentOrg: document.getElementById('currentOrg').value,
                currentPosition: document.getElementById('currentPosition').value,
                pastExperience: document.getElementById('pastExperience').value,
                linkedin: document.getElementById('linkedin').value,
                mobile: document.getElementById('mobile').value,
                email: document.getElementById('email').value,
                otherDetails: document.getElementById('otherDetails').value,
                role: userRole
            };
            fetch('/api/alumni', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(alumni)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchAlumni();
                    document.querySelectorAll('#editForm input').forEach(input => input.value = '');
                    alert('Alumni added!');
                } else {
                    alert(data.message);
                }
            });
        }

        // Edit alumni
        function editAlumni(id) {
            fetch('/api/alumni')
                .then(response => response.json())
                .then(data => {
                    const alumni = data.alumni.find(a => a._id === id);
                    if (alumni) {
                        document.getElementById('name').value = alumni.name;
                        document.getElementById('location').value = alumni.location;
                        document.getElementById('institute').value = alumni.institute;
                        document.getElementById('course').value = alumni.course;
                        document.getElementById('batchYear').value = alumni.batchYear;
                        document.getElementById('currentOrg').value = alumni.currentOrg;
                        document.getElementById('currentPosition').value = alumni.currentPosition;
                        document.getElementById('pastExperience').value = alumni.pastExperience;
                        document.getElementById('linkedin').value = alumni.linkedin;
                        document.getElementById('mobile').value = alumni.mobile;
                        document.getElementById('email').value = alumni.email;
                        document.getElementById('otherDetails').value = alumni.otherDetails;

                        const submitBtn = document.querySelector('#editForm button');
                        submitBtn.textContent = 'Update Alumni';
                        submitBtn.onclick = () => updateAlumni(id);
                    }
                });
        }

        // Update alumni
        function updateAlumni(id) {
            const alumni = {
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                institute: document.getElementById('institute').value,
                course: document.getElementById('course').value,
                batchYear: document.getElementById('batchYear').value,
                currentOrg: document.getElementById('currentOrg').value,
                currentPosition: document.getElementById('currentPosition').value,
                pastExperience: document.getElementById('pastExperience').value,
                linkedin: document.getElementById('linkedin').value,
                mobile: document.getElementById('mobile').value,
                email: document.getElementById('email').value,
                otherDetails: document.getElementById('otherDetails').value,
                role: userRole
            };
            fetch(`/api/alumni?id=${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(alumni)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchAlumni();
                    document.querySelectorAll('#editForm input').forEach(input => input.value = '');
                    const submitBtn = document.querySelector('#editForm button');
                    submitBtn.textContent = 'Add New Alumni';
                    submitBtn.onclick = addAlumni;
                    alert('Alumni updated!');
                } else {
                    alert(data.message);
                }
            });
        }

        // Remove alumni
        function removeAlumni(id) {
            if (confirm('Are you sure you want to delete this alumni record?')) {
                fetch(`/api/alumni?id=${id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role: userRole })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        fetchAlumni();
                        alert('Alumni removed!');
                    } else {
                        alert(data.message);
                    }
                });
            }
        }
    </script>
</body>
</html>
