<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loyola Alumni Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            color: #0a2351;
        }
        .header {
            background: #0a2351;
            color: #fff;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid #ffc107;
        }
        .header img.logo {
            width: 80px;
            vertical-align: middle;
            margin-right: 15px;
        }
        .header h1 {
            display: inline-block;
            margin: 0;
            font-size: 2em;
            font-weight: 600;
            vertical-align: middle;
        }
        .header p {
            margin: 5px 0 0;
            font-size: 1em;
            font-style: italic;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #0a2351;
            text-align: center;
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        .login-form, .edit-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 400px;
            margin: 0 auto 20px;
        }
        input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: #0a2351;
            outline: none;
        }
        button {
            padding: 12px;
            background: #0a2351;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background 0.3s, transform 0.2s;
        }
        button:hover {
            background: #1a3c78;
            transform: translateY(-2px);
        }
        .alumni-list {
            margin: 30px 0;
        }
        .alumni-card {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
            position: relative;
        }
        .alumni-card:hover {
            transform: scale(1.02);
        }
        .alumni-card a {
            color: #ffc107;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }
        .alumni-card a:hover {
            color: #ff8c00;
        }
        .admin-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .admin-actions button {
            padding: 8px 12px;
            font-size: 0.9em;
            background: #dc3545;
        }
        .admin-actions button:first-child {
            background: #28a745;
        }
        .admin-actions button:hover {
            background: #c82333;
        }
        .admin-actions button:first-child:hover {
            background: #218838;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .pagination button {
            padding: 8px 16px;
            background: #ddd;
            color: #0a2351;
        }
        .pagination button.active {
            background: #0a2351;
            color: white;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ffc107;
            color: #0a2351;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
        }
        .theme-toggle:hover {
            background: #ff8c00;
        }
        #editForm input {
            width: calc(50% - 10px);
            display: inline-block;
            margin: 5px;
        }
        #editForm input.full-width {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/yourusername/alumni-app/main/public/logo.png" alt="LAA Logo" class="logo">
        <h1>Loyola Alumni Network</h1>
        <p>Loyola College, Chennai - College of Excellence<br>Let Your Light Shine</p>
    </div>
    <div class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</div>
    <div class="container">
        <div id="loginSection">
            <div class="login-form">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button onclick="login()">Login</button>
            </div>
        </div>
        <div id="mainSection" class="hidden">
            <div class="alumni-list" id="alumniList"></div>
            <div class="pagination" id="pagination"></div>
            <div id="editForm" class="hidden">
                <h2>Add Alumni</h2>
                <div class="edit-form">
                    <input type="text" id="name" placeholder="Name" required>
                    <input type="text" id="location" placeholder="Location" required>
                    <input type="text" id="institute" placeholder="Institute" required>
                    <input type="text" id="course" placeholder="Course" required>
                    <input type="text" id="batchYear" placeholder="Batch Year" required>
                    <input type="text" id="currentOrg" placeholder="Current Organization" required>
                    <input type="text" id="currentPosition" placeholder="Current Position" required>
                    <input type="text" id="pastExperience" placeholder="Past Experience">
                    <input type="text" id="linkedin" placeholder="LinkedIn Profile">
                    <input type="text" id="mobile" placeholder="Mobile Number" required>
                    <input class="full-width" type="text" id="otherDetails" placeholder="Other Details">
                    <button onclick="addAlumni()">Add New Alumni</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userRole = null;
        let currentPage = 1;
        const itemsPerPage = 5;

        // Display alumni list
        function displayAlumni(data, totalPages) {
            const list = document.getElementById('alumniList');
            list.innerHTML = data.map(a => `
                <div class="alumni-card" data-id="${a._id}">
                    <h3>${a.name}</h3>
                    <p><strong>Location:</strong> ${a.location}</p>
                    <p><strong>Institute:</strong> ${a.institute} (${a.course}, ${a.batchYear})</p>
                    <p><strong>Current:</strong> ${a.currentPosition} at ${a.currentOrg}</p>
                    <p><strong>Past:</strong> ${a.pastExperience}</p>
                    <p><strong>Mobile:</strong> ${a.mobile}</p>
                    <p><strong>LinkedIn:</strong> <a href="${a.linkedin}" target="_blank">${a.linkedin}</a></p>
                    <p><strong>Other:</strong> ${a.otherDetails}</p>
                    ${userRole === 'admin' ? `
                        <div class="admin-actions">
                            <button onclick="editAlumni('${a._id}')">Edit</button>
                            <button onclick="removeAlumni('${a._id}')">Delete</button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            renderPagination(totalPages);
        }

        // Render pagination
        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.onclick = () => {
                    currentPage = i;
                    fetchAlumni();
                };
                pagination.appendChild(btn);
            }
        }

        // Login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    userRole = data.role;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('mainSection').classList.remove('hidden');
                    if (userRole === 'admin') {
                        document.getElementById('editForm').classList.remove('hidden');
                    }
                    fetchAlumni();
                } else {
                    alert('Login failed. Check credentials.');
                }
            });
        }

        // Fetch alumni data
        function fetchAlumni() {
            fetch(`/alumni?page=${currentPage}&limit=${itemsPerPage}`)
                .then(response => response.json())
                .then(data => displayAlumni(data.alumni, data.pages));
        }

        // Add new alumni
        function addAlumni() {
            const alumni = {
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                institute: document.getElementById('institute').value,
                course: document.getElementById('course').value,
                batchYear: document.getElementById('batchYear').value,
                currentOrg: document.getElementById('currentOrg').value,
                currentPosition: document.getElementById('currentPosition').value,
                pastExperience: document.getElementById('pastExperience').value,
                linkedin: document.getElementById('linkedin').value,
                mobile: document.getElementById('mobile').value,
                otherDetails: document.getElementById('otherDetails').value,
                role: userRole
            };
            fetch('/alumni', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(alumni)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchAlumni();
                    document.querySelectorAll('#editForm input').forEach(input => input.value = '');
                    alert('Alumni added!');
                } else {
                    alert(data.message);
                }
            });
        }

        // Edit alumni
        function editAlumni(id) {
            fetch('/alumni')
                .then(response => response.json())
                .then(data => {
                    const alumni = data.alumni.find(a => a._id === id);
                    if (alumni) {
                        document.getElementById('name').value = alumni.name;
                        document.getElementById('location').value = alumni.location;
                        document.getElementById('institute').value = alumni.institute;
                        document.getElementById('course').value = alumni.course;
                        document.getElementById('batchYear').value = alumni.batchYear;
                        document.getElementById('currentOrg').value = alumni.currentOrg;
                        document.getElementById('currentPosition').value = alumni.currentPosition;
                        document.getElementById('pastExperience').value = alumni.pastExperience;
                        document.getElementById('linkedin').value = alumni.linkedin;
                        document.getElementById('mobile').value = alumni.mobile;
                        document.getElementById('otherDetails').value = alumni.otherDetails;

                        const submitBtn = document.querySelector('#editForm button');
                        submitBtn.textContent = 'Update Alumni';
                        submitBtn.onclick = () => updateAlumni(id);
                    }
                });
        }

        // Update alumni
        function updateAlumni(id) {
            const alumni = {
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                institute: document.getElementById('institute').value,
                course: document.getElementById('course').value,
                batchYear: document.getElementById('batchYear').value,
                currentOrg: document.getElementById('currentOrg').value,
                currentPosition: document.getElementById('currentPosition').value,
                pastExperience: document.getElementById('pastExperience').value,
                linkedin: document.getElementById('linkedin').value,
                mobile: document.getElementById('mobile').value,
                otherDetails: document.getElementById('otherDetails').value,
                role: userRole
            };
            fetch(`/alumni/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(alumni)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchAlumni();
                    document.querySelectorAll('#editForm input').forEach(input => input.value = '');
                    const submitBtn = document.querySelector('#editForm button');
                    submitBtn.textContent = 'Add New Alumni';
                    submitBtn.onclick = addAlumni;
                    alert('Alumni updated!');
                } else {
                    alert(data.message);
                }
            });
        }

        // Remove alumni
        function removeAlumni(id) {
            if (confirm('Are you sure you want to delete this alumni record?')) {
                fetch(`/alumni/${id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role: userRole })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        fetchAlumni();
                        alert('Alumni removed!');
                    } else {
                        alert(data.message);
                    }
                });
            }
        }

        // Theme toggle (light mode only, removing dark mode for branding consistency)
        function toggleTheme() {
            // Theme toggle removed for branding consistency
        }
    </script>
</body>
</html>